#:import NoTransition kivy.uix.screenmanager.NoTransition

<Label>
    size_hint: 0.1,0.1
    font_size:17
    color: 0,0,0,1
<ProgressBar>
    min:0
    max:100
<Button>
    size_hint:0.26,0.1
    color: 1, 1, 1, 1

ScreenManager:
    transition: NoTransition()
    id: screen_manager
    var: 100

    MainPage:
        name: 'mainpage'
        id: main
        location_infotxt: location_info
        tcpip: tcpip
        port: port
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos:self.pos
                size:self.size

        FloatLayout:
            Label:
                text: "TCP/IP:"
                font_size: 19
                pos_hint: {"x": 0.15, "y": 0.7}
            TextInput:
                id: tcpip
                text: ""
                multiline: False
                size_hint: 0.5,0.1
                pos_hint: {"x": 0.25, "y": 0.7}
            Label:
                text: "Port:"
                font_size: 19
                pos_hint: {"x": 0.15, "y": 0.6}
            TextInput:
                id: port
                text: ""
                multiline: False
                size_hint: 0.5,0.1
                pos_hint: {"x": 0.25, "y": 0.6}
            Button:
                text:"Enter"
                size_hint: 0.1,0.15
                pos_hint: {"x": 0.77, "y": 0.625}
                on_release:
                    main.start_tcp()
                    app.root.current = "popup"

            Button:
                text:"Offline Deney"
                size_hint: 0.6,0.1
                pos_hint: {"x": 0.2, "y": 0.2}
                on_release:
                    app.root.current = "popup"



    ExercisePage:
        name: 'exercisepage'
        id: excs
        location_infotxt: location_info
        var: screen_manager.var
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos:self.pos
                size:self.size

        FloatLayout:
            Button:
                text:"Deney"
                size_hint: 0.5,0.075
                pos_hint: {"x": 0, "top": 0.075}
                on_release:
                    app.root.current = "exercisepage"

            Button:
                text:"Kamera"
                size_hint: 0.5,0.075
                pos_hint: {"x": 0.5, "top": 0.075}
                on_release:
                    app.root.current = "campage"

            Label:
                text:"[b]DENEYLER[/b]"
                font_size: 22
                markup: True
                pos_hint: {"center_x": 0.5, "top": 0.95}




    ExercisePopUp:
        name: 'popup'
        id: pop
        location_info: location_info
        var: screen_manager.var
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos:self.pos
                size:self.size

        FloatLayout:
            Button:
                text:"Elektropnömatik Kumanda Devresi"
                size_hint: 0.25,0.15
                pos_hint: {"x": 0.275, "y": 0.326}
                on_release:
                    app.root.current = "circuit"

            Button:
                text:"Başlat"
                size_hint: 0.2,0.09
                pos_hint: {"x": 0.3, "y": 0.236}
                on_release:
                    pop.send_data()

            Button:
                text:"Durdur"
                size_hint: 0.2,0.09
                pos_hint: {"x": 0.3, "y": 0.146}
                on_release:
                    pop.stopbutton()
            ScrollView:
                id: scrlv1
                size_hint: 0.4, 0.825
                pos_hint: {"x": 0.55, "top": 0.9}
                TextInput:
                    id: location_info
                    multiline: True
                    readonly: True
                    text: ""
                    size_hint: 1, None
                    height: max( (len(self._lines)+1) * self.line_height, scrlv1.height)

            Label:
                text:"[b]DENEYLER[/b]"
                font_size: 22
                markup: True
                pos_hint: {"x": 0.08, "top": 0.95}

            ScrollView:
                size_hint_x: .25
                size_hint_y: .715
                pos_hint: {"x": 0, "y": .11}
                do_scroll_x: False
                do_scroll_y: True

                GridLayout:
                    size: root.width, root.height
                    size_hint_x: 1
                    size_hint_y: None
                    cols: 1
                    height: self.minimum_height
                    row_default_height: 100
                    row_force_default: True

                    Button:
                        text:"Deney 1"
                        on_release:
                            root.var = 100
                            pop.exercise_name()

                    Button:
                        text:"Deney 2"
                        on_release:
                            root.var = 200
                            pop.exercise_name()

                    Button:
                        text:"Deney 3"
                        on_release:
                            root.var = 300
                            pop.exercise_name()

                    Button:
                        text:"Deney 4"
                        on_release:
                            root.var = 400
                            pop.exercise_name()

                    Button:
                        text:"Deney 5"
                        on_release:
                            root.var = 500
                            pop.exercise_name()

                    Button:
                        text:"Deney 6"
                        on_release:
                            root.var = 600
                            pop.exercise_name()

                    Button:
                        text:"Deney 7"
                        on_release:
                            root.var = 700
                            pop.exercise_name()

                    Button:
                        text:"Deney 8"
                        on_release:
                            root.var = 800
                            pop.exercise_name()

                    Button:
                        text:"Deney 9"
                        on_release:
                            root.var = 900
                            pop.exercise_name()

                    Button:
                        text:"Deney 10"
                        on_release:
                            root.var = 1000
                            pop.exercise_name()

                    Button:
                        text:"Deney 11"
                        on_release:
                            root.var = 1100
                            pop.exercise_name()

                    Button:
                        text:"Deney 12"
                        on_release:
                            root.var = 1200
                            pop.exercise_name()

                    Button:
                        text:"Deney 13"
                        on_release:
                            root.var = 1300
                            pop.exercise_name()

                    Button:
                        text:"Deney 14"
                        on_release:
                            root.var = 1400
                            pop.exercise_name()

                    Button:
                        text:"Deney 15"
                        on_release:
                            root.var = 1500
                            pop.exercise_name()

                    Button:
                        text:"Deney 16"
                        on_release:
                            root.var = 1600
                            pop.exercise_name()

                    Button:
                        text:"Deney 17"
                        on_release:
                            root.var = 1700
                            pop.exercise_name()

                    Button:
                        text:"Deney 18"
                        on_release:
                            root.var = 1800
                            pop.exercise_name()

                    Button:
                        text:"Deney 19"
                        on_release:
                            root.var = 1900
                            pop.exercise_name()

                    Button:
                        text:"Deney 20"
                        on_release:
                            root.var = 2000
                            pop.exercise_name()

                    Button:
                        text:"Deney 21"
                        on_release:
                            root.var = 2100
                            pop.exercise_name()

                    Button:
                        text:"Deney 22"
                        on_release:
                            root.var = 2200
                            pop.exercise_name()

                    Button:
                        text:"Deney 23"
                        on_release:
                            root.var = 2300
                            pop.exercise_name()

                    Button:
                        text:"Deney 24"
                        on_release:
                            root.var = 2400
                            pop.exercise_name()

                    Button:
                        text:"Deney 25"
                        on_release:
                            root.var = 2500
                            pop.exercise_name()

                    Button:
                        text:"Deney 26"
                        on_release:
                            root.var = 2600
                            pop.exercise_name()

                    Button:
                        text:"Deney 27"
                        on_release:
                            root.var = 2700
                            pop.exercise_name()

            Button:
                text:"Geri"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0, "y": 0}
                on_release:
                    root.var = (root.var//100)*100
                    app.root.current = "mainpage"


    CircuitPage:
        name: 'circuit'
        id: circ
        my_image1: my_image1
        var: screen_manager.var
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos:self.pos
                size:self.size

        FloatLayout:
            GridLayout:
                cols: 1
                pos_hint: {"top": .895, "left": 1}
                size_hint: 1, .795
                StencilView:
                    id: stencil1
                    Scatter:
                        id: scatter
                        pos: stencil1.pos
                        size: my_image1.size
                        Image:
                            id: my_image1
                            source: circ.img_src
                            allow_stretch: True
                            keep_ratio: True
                            size: stencil1.width, stencil1.height

            Button:
                text:"Geri"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0, "y": 0}
                on_release:
                    root.var = (root.var//100)*100
                    app.root.current = "popup"
            Button:
                text:"Sonraki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.8, "y": 0}
                on_release:
                    app.root.current = "player"

            Button:
                text:"Önceki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.6, "y": 0}



    CircuitPage2:
        on_enter: print(root.var)
        name: 'circuit2'
        id: circ2
        my_image2: my_image2
        var: screen_manager.var
        txt_input: txt_input
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos:self.pos
                size:self.size

        FloatLayout:
            GridLayout:
                cols: 1
                pos_hint: {"top": .895, "x": 0}
                size_hint: 0.6, .795
                StencilView:
                    id: stencil2
                    Scatter:
                        id: scatter
                        pos: stencil2.pos
                        size: my_image2.size
                        Image:
                            id: my_image2
                            source: circ2.img2_src
                            allow_stretch: True
                            keep_ratio: True
                            size: stencil2.width, stencil2.height
            ScrollView:
                id: scrlv2
                size_hint: 0.4, .82
                pos_hint: {"top": .895, "x": 0.6}
                TextInput:
                    id: txt_input
                    multiline: True
                    readonly: True
                    text: "•	Öncelikle START butonuna basılarak K0 rölesinin mühürlenmesi sağlanır ve K0 anahtarı kapalı konuma geçtiği için sistem çalışmaya başlar. Piston başlangıç konumu olarak S1 konumunda olduğu için S1 anahtarı kapalı konumda olur ve Z0 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z0 zaman rölesi 0.8 saniye bekledikten sonra Z0 anahtarını kapalı konumuna geçirerek YV0 valf selenoidinin aktifleşmesini sağlar ve piston ileri gitmeye başlar. Piston S2 konumuna geldiğinde S2 anahtarı kapalı konuma geçer ve Z1 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z1 zaman rölesi 0.6 saniye bekledikten sonra Z1 anahtarını kapalı konumuna geçirerek YV1 valf selenoidinin aktifleşmesini sağlar ve piston geri döner. •	Öncelikle START butonuna basılarak K0 rölesinin mühürlenmesi sağlanır ve K0 anahtarı kapalı konuma geçtiği için sistem çalışmaya başlar. Piston başlangıç konumu olarak S1 konumunda olduğu için S1 anahtarı kapalı konumda olur ve Z0 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z0 zaman rölesi 0.8 saniye bekledikten sonra Z0 anahtarını kapalı konumuna geçirerek YV0 valf selenoidinin aktifleşmesini sağlar ve piston ileri gitmeye başlar. Piston S2 konumuna geldiğinde S2 anahtarı kapalı konuma geçer ve Z1 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z1 zaman rölesi 0.6 saniye bekledikten sonra Z1 anahtarını kapalı konumuna geçirerek YV1 valf selenoidinin aktifleşmesini sağlar ve piston geri döner. •	Öncelikle START butonuna basılarak K0 rölesinin mühürlenmesi sağlanır ve K0 anahtarı kapalı konuma geçtiği için sistem çalışmaya başlar. Piston başlangıç konumu olarak S1 konumunda olduğu için S1 anahtarı kapalı konumda olur ve Z0 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z0 zaman rölesi 0.8 saniye bekledikten sonra Z0 anahtarını kapalı konumuna geçirerek YV0 valf selenoidinin aktifleşmesini sağlar ve piston ileri gitmeye başlar. Piston S2 konumuna geldiğinde S2 anahtarı kapalı konuma geçer ve Z1 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z1 zaman rölesi 0.6 saniye bekledikten sonra Z1 anahtarını kapalı konumuna geçirerek YV1 valf selenoidinin aktifleşmesini sağlar ve piston geri döner. •	Öncelikle START butonuna basılarak K0 rölesinin mühürlenmesi sağlanır ve K0 anahtarı kapalı konuma geçtiği için sistem çalışmaya başlar. Piston başlangıç konumu olarak S1 konumunda olduğu için S1 anahtarı kapalı konumda olur ve Z0 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z0 zaman rölesi 0.8 saniye bekledikten sonra Z0 anahtarını kapalı konumuna geçirerek YV0 valf selenoidinin aktifleşmesini sağlar ve piston ileri gitmeye başlar. Piston S2 konumuna geldiğinde S2 anahtarı kapalı konuma geçer ve Z1 zaman rölesine elektrik enerjisini ileterek çalışmasını sağlar. Z1 zaman rölesi 0.6 saniye bekledikten sonra Z1 anahtarını kapalı konumuna geçirerek YV1 valf selenoidinin aktifleşmesini sağlar ve piston geri döner."
                    size_hint: 1, None
                    height: max( (len(self._lines)+1) * self.line_height, scrlv2.height)


            Button:
                text:"Geri"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0, "y": 0}
                on_release:
                    root.var = (root.var//100)*100
                    app.root.current = "player"
            Button:
                text:"Sonraki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.8, "y": 0}
                on_release:
                    root.var = root.var + 1
                    circ2.check_file()
                    if circ2.file_exists == False: root.var = root.var - 1
                    circ2.image_source()
                    print(root.var)

            Button:
                text:"Önceki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.6, "y": 0}
                on_release:
                    root.var = root.var - 1
                    if root.var%100 == 0: app.root.current = "player"
                    circ2.image_source()
                    print(root.var)

    PlcPage:
        name: 'plc'
        id: plc
        my_image3: my_image3
        var: screen_manager.var
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos:self.pos
                size:self.size

        FloatLayout:
            GridLayout:
                cols: 1
                pos_hint: {"top": .895, "left": 1}
                size_hint: 1, .795
                StencilView:
                    id: stencil3
                    Scatter:
                        id: scatter
                        pos: stencil3.pos
                        size: my_image3.size
                        Image:
                            id: my_image3
                            source: './img/PLC.png'
                            allow_stretch: True
                            keep_ratio: True
                            size: stencil3.width, stencil3.height

            Button:
                text:"Geri"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0, "y": 0}
                on_release:
                    root.var = (root.var//100)*100
                    app.root.current = "popup"
            Button:
                text:"Sonraki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.8, "y": 0}
                on_release:
                    root.var = root.var + 1
                    plc.check_file()
                    if plc.file_exists == False: root.var = root.var - 1
                    plc.image_source()


            Button:
                text:"Önceki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.6, "y": 0}
                on_release:
                    root.var = root.var - 1
                    if root.var%100 == 49: root.var = root.var + 1
                    plc.image_source()


    Player:
        name: 'player'
        var: screen_manager.var
        my_video: my_video
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos:self.pos
                size:self.size

        FloatLayout:
            GridLayout:
                cols: 1
                pos_hint: {"top": .895, "left": 1}
                size_hint: 1, .795
                StencilView:
                    id: stencil4
                    Scatter:
                        id: scatter
                        pos: stencil4.pos
                        size: my_video.size
                        VideoPlayer:
                            id: my_video
                            source: "./img/vid100.mp4"
                            size: stencil4.width, stencil4.height
            Button:
                text:"Geri"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0, "y": 0}
                on_release:
                    root.var = (root.var//100)*100
                    app.root.current = "popup"
            Button:
                text:"Sonraki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.8, "y": 0}
                on_release:
                    root.var = root.var + 1
                    app.root.current = "circuit2"

            Button:
                text:"Önceki"
                size_hint: 0.2,0.075
                pos_hint: {"x": 0.6, "y": 0}
                on_release:
                    app.root.current = "circuit"